<!-- Footer -->
<footer class="wrapper style1 align-center">
    <div class="inner">
        <ul class="icons">
            {{ with .Site.Params.social.github }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-github"><span class="label">Github</span></a></li>{{end}}
            {{ with .Site.Params.social.twitter }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-twitter"><span class="label">Twitter</span></a></li>{{end}}
            {{ with .Site.Params.social.instagram }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a></li>{{end}}
            {{ with .Site.Params.social.linkedin }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-linkedin"><span class="label">LinkedIn</span></a></li>{{end}}
            {{ with .Site.Params.social.email }}<li><a target="_blank" href="mailto:{{.}}" class="fav icon style2 fa-envelope"><span class="label">Email</span></a></li>{{end}}
        </ul>
        <p>Hugo Story &copy; 2020 <a target="_blank" href="https://github.com/caressofsteel/">CaressOfSteel</a><span class="footerspacer icon fa-diamond"></span>
            Ported from <a target="_blank" href="https://html5up.net/uploads/demos/story/">Story</a> by HTML5UP<span class="footerspacer icon fa-diamond"></span>
            Images courtesy of <a target="_blank" href="https://unsplash.com">Unsplash</a></p>
</div>
</footer>

<script>
(function () {
  const nav = document.getElementById('floating-nav');
  if (!nav) return;

  const links = [...nav.querySelectorAll('a[data-scroll]')];
  const banner = document.getElementById('banner');

  const show = () => nav.classList.add('is-visible');
  const hide = () => nav.classList.remove('is-visible');

  // Show/hide based on banner visibility (same as before)
  if (!banner) show();
  else {
    const io = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting && entry.intersectionRatio > 0.2) hide();
        else show();
      });
    }, { threshold: [0, 0.2, 0.4] });
    io.observe(banner);
  }

  // --- precise smooth scroll with custom offset ---
  function scrollToWithOffset(target) {
    if (!target) return;
    // measure current nav height in case it wraps on small screens
    const navH = Math.round(nav.getBoundingClientRect().height) || 56;
    const extra = 12; // scroll a bit further so NO previous section is visible
    const y = target.getBoundingClientRect().top + window.pageYOffset - navH - extra;
    window.scrollTo({ top: Math.max(0, y), behavior: 'smooth' });
  }

  // Handle clicks
  nav.addEventListener('click', e => {
    const a = e.target.closest('a[data-scroll]');
    if (!a) return;
    const href = a.getAttribute('href') || '';
    if (href.startsWith('#')) {
      e.preventDefault();
      show(); // make sure bar is visible immediately
      const target = document.querySelector(href);
      scrollToWithOffset(target);
    }
  });

  // Optional: if someone loads with a hash, align it perfectly too
  window.addEventListener('load', () => {
    if (location.hash) {
      const t = document.querySelector(location.hash);
      // small timeout so layout settles before measuring
      setTimeout(() => scrollToWithOffset(t), 0);
    }
  });

  // Active link highlighting (unchanged)
  const highlight = id => {
    links.forEach(link => {
      link.classList.toggle('is-active', link.getAttribute('href') === '#' + id);
    });
  };
  const ids = links.map(a => a.getAttribute('href')).filter(h => h && h.startsWith('#')).map(h => h.slice(1));
  const sections = ids.map(id => document.getElementById(id)).filter(Boolean);
  const secObserver = new IntersectionObserver(entries => {
    entries.forEach(entry => { if (entry.isIntersecting) highlight(entry.target.id); });
  }, { rootMargin: '-40% 0px -40% 0px', threshold: 0 });
  sections.forEach(sec => secObserver.observe(sec));
})();
</script>
