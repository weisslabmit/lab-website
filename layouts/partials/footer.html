<!-- Footer -->
<footer class="wrapper style1 align-center">
    <div class="inner">
        <ul class="icons">
            {{ with .Site.Params.social.github }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-github"><span class="label">Github</span></a></li>{{end}}
            {{ with .Site.Params.social.twitter }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-twitter"><span class="label">Twitter</span></a></li>{{end}}
            {{ with .Site.Params.social.instagram }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a></li>{{end}}
            {{ with .Site.Params.social.linkedin }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-linkedin"><span class="label">LinkedIn</span></a></li>{{end}}
            {{ with .Site.Params.social.email }}<li><a target="_blank" href="mailto:{{.}}" class="fav icon style2 fa-envelope"><span class="label">Email</span></a></li>{{end}}
        </ul>
        <p>Hugo Story &copy; 2020 <a target="_blank" href="https://github.com/caressofsteel/">CaressOfSteel</a><span class="footerspacer icon fa-diamond"></span>
            Ported from <a target="_blank" href="https://html5up.net/uploads/demos/story/">Story</a> by HTML5UP<span class="footerspacer icon fa-diamond"></span>
            Images courtesy of <a target="_blank" href="https://unsplash.com">Unsplash</a></p>
</div>
</footer>

<script>
(function () {
  const iframe = document.getElementById('lab-timeline');
  const timelineBlock = document.getElementById('research-timeline');
  if (!iframe || !timelineBlock) return;

  const wanted = iframe.getAttribute('data-src');
  let loaded = false;
  let delayTimer = null;

  function loadTimeline() {
    if (loaded) return;
    loaded = true;
    iframe.src = wanted;
    if (io) io.disconnect();
  }

  // ❶ Load immediately if "Research" is clicked
  const researchLink =
    document.querySelector('#floating-nav a[href="#research"]') ||
    document.querySelector('a[href="#research"][data-scroll]');
  if (researchLink) {
    researchLink.addEventListener('click', loadTimeline, { once: true });
  }

  // ❷ Load immediately if arriving directly on #research
  if (location.hash === '#research') loadTimeline();
  window.addEventListener('hashchange', () => {
    if (location.hash === '#research') loadTimeline();
  });

  // ❸ Load once any pixel of the TIMELINE wrapper enters view (after 0.3 s)
  const io = new IntersectionObserver((entries) => {
    if (loaded) return;
    for (const e of entries) {
      if (e.isIntersecting) {
        // start 300ms delay before actually loading
        clearTimeout(delayTimer);
        delayTimer = setTimeout(loadTimeline, 300);
        break;
      } else {
        // cancel if it scrolled out before delay ends
        clearTimeout(delayTimer);
      }
    }
  }, { threshold: 0, rootMargin: '0px' });

  io.observe(timelineBlock);

  // ❹ Failsafe: load after 2 s no matter what
  setTimeout(() => { if (!loaded) loadTimeline(); }, 2000);
})();
</script>
