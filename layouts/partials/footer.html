<!-- Footer -->
<footer class="wrapper style1 align-center">
    <div class="inner">
        <ul class="icons">
            {{ with .Site.Params.social.github }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-github"><span class="label">Github</span></a></li>{{end}}
            {{ with .Site.Params.social.twitter }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-twitter"><span class="label">Twitter</span></a></li>{{end}}
            {{ with .Site.Params.social.instagram }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a></li>{{end}}
            {{ with .Site.Params.social.linkedin }}<li><a target="_blank" href="{{.}}" class="icon brands style2 fa-linkedin"><span class="label">LinkedIn</span></a></li>{{end}}
            {{ with .Site.Params.social.email }}<li><a target="_blank" href="mailto:{{.}}" class="fav icon style2 fa-envelope"><span class="label">Email</span></a></li>{{end}}
        </ul>
        <p>Hugo Story &copy; 2020 <a target="_blank" href="https://github.com/caressofsteel/">CaressOfSteel</a><span class="footerspacer icon fa-diamond"></span>
            Ported from <a target="_blank" href="https://html5up.net/uploads/demos/story/">Story</a> by HTML5UP<span class="footerspacer icon fa-diamond"></span>
            Images courtesy of <a target="_blank" href="https://unsplash.com">Unsplash</a></p>
</div>
</footer>

<script>
(function () {
  const nav = document.getElementById('floating-nav');
  if (!nav) return;

  const inner = nav.querySelector('.floating-nav__inner');
  const links = Array.from(nav.querySelectorAll('a[data-scroll]'));
  const hrefToId = (href) => href && href.startsWith('#') ? href.slice(1) : null;
  const ids = links.map(a => hrefToId(a.getAttribute('href'))).filter(Boolean);
  const sections = ids.map(id => document.getElementById(id)).filter(Boolean);
  const banner = document.getElementById('banner');

  /* --- show/hide nav only based on banner visibility --- */
  function showNav() { nav.classList.add('is-visible'); }
  function hideNav() { nav.classList.remove('is-visible'); }

  let io;
  function connectObserver() {
    if (!banner) { showNav(); return; }
    io = new IntersectionObserver(entries => {
      const e = entries[0];
      if (e && e.isIntersecting && e.intersectionRatio > 0.2) {
        // Banner clearly visible: hide bar
        hideNav();
      } else {
        showNav();
      }
    }, { threshold: [0, 0.2, 0.4] });
    io.observe(banner);
  }
  connectObserver();

  /* --- active link styling (bold + dim others) --- */
  function setActive(id) {
    let any = false;
    links.forEach(a => {
      const active = (a.getAttribute('href') === '#' + id);
      a.classList.toggle('is-active', active);
      if (active) {
        // force bold over your global 400!important
        a.style.setProperty('font-weight', '700', 'important');
        any = true;
      } else {
        a.style.removeProperty('font-weight');
      }
    });
    inner.classList.toggle('has-active', any);
  }

  const sectionIO = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) setActive(entry.target.id);
    });
  }, { rootMargin: '-40% 0px -40% 0px', threshold: 0 });
  sections.forEach(sec => sectionIO.observe(sec));

  /* --- smooth scroll with exact offset so no previous section shows --- */
  function navHeight() {
    const h = Math.round(nav.getBoundingClientRect().height);
    return h || 56;
  }
  function scrollToSection(el) {
    if (!el) return;
    const extraClear = 14; // push a touch further so previous section never peeks
    const y = el.getBoundingClientRect().top + window.pageYOffset - navHeight() - extraClear;
    window.scrollTo({ top: Math.max(0, y), behavior: 'smooth' });
  }

  nav.addEventListener('click', (e) => {
    const a = e.target.closest('a[data-scroll]');
    if (!a) return;
    const href = a.getAttribute('href') || '';
    if (!href.startsWith('#')) return;
    e.preventDefault();
    showNav(); // ensure bar is visible during the jump
    if (io) io.disconnect(); // avoid flicker while scrolling
    scrollToSection(document.querySelector(href));
    setTimeout(connectObserver, 600); // resume after motion
  });

  /* --- handle loading with an initial hash --- */
  window.addEventListener('load', () => {
    if (location.hash) {
      const t = document.querySelector(location.hash);
      setTimeout(() => scrollToSection(t), 0);
    }
  });
})();
</script>
