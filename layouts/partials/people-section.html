{{/* ========= PEOPLE SECTION (flat files in content/people) ========= */}}
{{ $people := site.GetPage "section" "people" }}
{{ if not $people }}{{ errorf "people-section.html: 'content/people' not found" }}{{ end }}

{{/* Email obfuscation helper */}}
{{- define "obf" -}}
  {{- replace (replace . "@" " (at) ") "." " (dot) " -}}
{{- end -}}

{{ $roles := slice "PI" "Staff" "PhD" "Postdoc" "Other" "Undergrad" }}
{{ $labels := dict "PI" "PI" "Staff" "Staff" "PhD" "PhD Students" "Postdoc" "Postdocs" "Other" "Other" "Undergrad" "Undergrads" }}

<section id="people" class="people-section">
  {{/* 1) Featured PI spanning full width, using your .person-highlight layout */}}
  {{ $pi := where $people.RegularPages ".Params.role" "PI" | sort "Weight" "asc" | sort "Title" "asc" }}
  {{ if gt (len $pi) 0 }}
    {{ $p := index $pi 0 }}
    <div class="people-grid">
      <article class="person-card person-highlight">
        <a class="image avatar" href="{{ $p.RelPermalink }}">
          {{ with $p.Params.image }}
            <img src="{{ . | relURL }}" alt="{{ $p.Title }}" loading="lazy">
          {{ else }}
            <img src="/uploads/placeholder.png" alt="" loading="lazy">
          {{ end }}
        </a>
        <div class="content">
          <h3><a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a></h3>
          <div class="role">PI</div>
          {{ with $p.Params.short }}<p class="bio">{{ . }}</p>{{ end }}
          {{ with $p.Params.email }}<span class="person-email">{{ template "obf" . }}</span>{{ end }}
          <div class="person-links">
            {{ with $p.Params.website }}<a href="{{ . }}" target="_blank" rel="noopener"><span class="icon">üîó</span></a>{{ end }}
            {{ with $p.Params.scholar }}<a href="{{ . }}" target="_blank" rel="noopener"><span class="icon">üéì</span></a>{{ end }}
            {{ with $p.Params.github  }}<a href="{{ . }}" target="_blank" rel="noopener"><span class="icon">üêô</span></a>{{ end }}
          </div>
        </div>
      </article>
    </div>
  {{ end }}

  {{/* 2) Other roles as grids, using your .people-group-title + .people-grid + .person-card */}}
  {{ range $roles }}
    {{ if ne . "PI" }}
      {{ $group := where $people.RegularPages ".Params.role" . | sort "Weight" "asc" | sort "Title" "asc" }}
      {{ if gt (len $group) 0 }}
        <h3 class="people-group-title">{{ index $labels . }}</h3>
        <div class="people-grid">
          {{ range $group }}
            <article class="person-card">
              <a class="image avatar" href="{{ .RelPermalink }}">
                {{ with .Params.image }}
                  <img src="{{ . | relURL }}" alt="{{ .Title }}" loading="lazy">
                {{ else }}
                  <img src="/uploads/placeholder.png" alt="" loading="lazy">
                {{ end }}
              </a>
              <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
              <div class="role">{{ index $labels .Params.role | default .Params.role }}</div>
              {{ with .Params.short }}<p class="bio">{{ . }}</p>{{ end }}
              {{ with .Params.email }}<span class="person-email">{{ template "obf" . }}</span>{{ end }}
              <div class="person-links">
                {{ with .Params.website }}<a href="{{ . }}" target="_blank" rel="noopener"><span class="icon">üîó</span></a>{{ end }}
                {{ with .Params.scholar }}<a href="{{ . }}" target="_blank" rel="noopener"><span class="icon">üéì</span></a>{{ end }}
                {{ with .Params.github  }}<a href="{{ . }}" target="_blank" rel="noopener"><span class="icon">üêô</span></a>{{ end }}
              </div>
            </article>
          {{ end }}
        </div>
      {{ end }}
    {{ end }}
  {{ end }}
</section>
