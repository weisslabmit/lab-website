{{ $raw := site.Data.publications_zotero }}
{{ $items := slice }}
{{ if $raw }}
  {{ $maybe := index $raw "items" }}
  {{ if $maybe }}{{ $items = $maybe }}{{ else }}{{ $items = $raw }}{{ end }}
{{ end }}

{{ if lt (len $items) 1 }}
  <p>No publications yet.</p>
{{ else }}
  <section id="publications">
    <h2>Publications</h2>
    <ul>
      {{ range first 20 $items }}  {{/* show first 20 items only */}}
        <li>
          {{ .title }}
          {{ with (index . "author") }}
            — {{ range $i, $a := . }}
                {{ if gt $i 0 }}, {{ end }}
                {{ $a.family }}
              {{ end }}
          {{ end }}
          {{ with (index . "container-title") }}, <em>{{ . }}</em>{{ end }}
          {{ with (index . "issued") }}
            {{ $dp := index . "date-parts" }}
            {{ if and $dp (ge (len $dp) 1) (ge (len (index $dp 0)) 1) }}
              ({{ index (index $dp 0) 0 }})
            {{ end }}
          {{ end }}
        </li>
      {{ end }}
    </ul>
    <p><a href="/publications/">See all publications →</a></p>
  </section>
{{ end }}
